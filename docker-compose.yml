# Docker Compose para Migro Hiring Frontend

services:
  # ==========================================
  # Servicio de Desarrollo
  # ==========================================
  dev:
    container_name: migro-hiring-dev
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    ports:
      - "5173:5173"
    volumes:
      # Montar código fuente para hot reload
      - .:/app
      # Usar volumen para node_modules (mejor performance)
      - node_modules:/app/node_modules
    env_file:
      - .env
    environment:
      - NODE_ENV=development
    networks:
      - migro-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:5173"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # ==========================================
  # Servicio de Producción (nginx)
  # ==========================================
  prod:
    container_name: migro-hiring-prod
    build:
      context: .
      dockerfile: Dockerfile
      target: runner
      args:
        - VITE_API_BASE_URL=${VITE_API_BASE_URL:-https://api.migro.es/api/v1}
        - VITE_STRIPE_PUBLISHABLE_KEY=${VITE_STRIPE_PUBLISHABLE_KEY}
        - VITE_APP_URL=${VITE_APP_URL:-https://contratacion.migro.es}
    ports:
      - "80:80"
    networks:
      - migro-network
    restart: unless-stopped
    profiles:
      - production

  # ==========================================
  # Servicio adicional: Mock API (opcional para desarrollo)
  # ==========================================
  mock-api:
    image: stoplight/prism:latest
    container_name: migro-hiring-mock-api
    command: mock -h 0.0.0.0 /openapi.yml
    ports:
      - "8000:4010"
    volumes:
      - ./docker/openapi.yml:/openapi.yml:ro
    networks:
      - migro-network
    profiles:
      - mock
    restart: unless-stopped

volumes:
  node_modules:

networks:
  migro-network:
    driver: bridge

